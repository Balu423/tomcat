########################################################################
#
# title:       Docker Compose v2 YAML file for spring-music
# author:      Gary A. Stafford (https://programmaticponderings.com)
# url:         https://github.com/garystafford/spring-music-docker.git
# description: Builds single VM, multi-container environment
#              with debugging ports open and extra header information
# usage:       docker-compose -f docker-compose-v2.yml -p music up -d
#
########################################################################

version: '2'
services:

  proxy:
    build: nginx/
    ports:
     - "80:80"
    depends_on:
     - app01
     - app02
    hostname: "proxy"
    container_name: "proxy"

  app01:
    build: tomcat/
    ports:
     - "8180:8080"
    depends_on:
     - mongodb
    hostname: "app01"
    container_name: "app01"

  app02:
    build: tomcat/
    ports:
     - "8280:8080"
    depends_on:
     - mongodb
    hostname: "app02"
    container_name: "app02"

  mongodb:
    build: mongodb/
    depends_on:
     - elk
    hostname: "mongodb"
    container_name: "mongodb"
    volumes:
     - "music_data:/data/db"
     - "music_data:/data/configdb"

  elk:
    image: sebp/elk:latest
    ports:
      - "5601:5601"
      - "9200:9200"
      - "5044:5044"
      - "5000:5000"
    hostname: "elk"
    container_name: "elk"

volumes:
  music_data:
    external: true
